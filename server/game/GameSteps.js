export const GameSteps2 = [
    {number: 0, multiplier: 1, qualityBonus: 0,  bonusLuck: 0, probabilityToLose: 0.04},
    {number: 1, multiplier: 1.03, qualityBonus: 6875,  bonusLuck: 5, probabilityToLose: 0.04166666667},
    {number: 2, multiplier: 1.06, qualityBonus: 6875,  bonusLuck: 5, probabilityToLose: 0.04347826087},
    {number: 3, multiplier: 1.12, qualityBonus: 6875,  bonusLuck: 5, probabilityToLose: 0.04545454545},
    {number: 4, multiplier: 1.2, qualityBonus: 6875,  bonusLuck: 5, probabilityToLose: 0.04761904762},
    {number: 5, multiplier: 1.25, qualityBonus: 5833,  bonusLuck: 7, probabilityToLose: 0.05},
    {number: 6, multiplier: 1.3, qualityBonus:  5833,  bonusLuck: 7, probabilityToLose: 0.05263157895},
    {number: 7, multiplier: 1.35, qualityBonus: 5833,  bonusLuck: 7, probabilityToLose: 0.05555555556},
    {number: 8, multiplier: 1.45, qualityBonus: 5833,  bonusLuck: 7, probabilityToLose: 0.05882352941},
    {number: 9, multiplier: 1.55, qualityBonus: 5184,  bonusLuck: 10, probabilityToLose: 0.0625},
    {number: 10, multiplier: 1.65, qualityBonus: 5184,  bonusLuck: 10, probabilityToLose: 0.06666666667},
    {number: 11, multiplier: 1.75, qualityBonus: 5184,  bonusLuck: 10, probabilityToLose: 0.07142857143},
    {number: 12, multiplier: 1.85, qualityBonus: 5184,  bonusLuck: 10, probabilityToLose: 0.07692307692},
    {number: 13, multiplier: 2, qualityBonus: 4167,  bonusLuck: 20, probabilityToLose: 0.08333333333},
    {number: 14, multiplier: 2.25, qualityBonus: 4167,  bonusLuck: 20, probabilityToLose: 0.09090909091},
    {number: 15, multiplier: 2.5, qualityBonus: 4167,  bonusLuck: 20, probabilityToLose: 0.1},
    {number: 16, multiplier: 2.75, qualityBonus: 3788,  bonusLuck: 30, probabilityToLose: 0.1111111111},
    {number: 17, multiplier: 3, qualityBonus: 3788,  bonusLuck: 30, probabilityToLose: 0.1111111111},
    {number: 18, multiplier: 3.5, qualityBonus: 3472,  bonusLuck: 50, probabilityToLose: 0.125},
    {number: 19, multiplier: 4, qualityBonus: 1667,  bonusLuck: 75, probabilityToLose: 0.1428571429},
    {number: 20, multiplier: 5, qualityBonus: 1042,  bonusLuck: 100, probabilityToLose: 0.1666666667},
    {number: 21, multiplier: 6, qualityBonus: 833,  bonusLuck: 150, probabilityToLose: 0.2},
    {number: 22, multiplier: 8, qualityBonus: 694,  bonusLuck: 200, probabilityToLose: 0.25},
    {number: 23, multiplier: 10, qualityBonus: 595,  bonusLuck: 300, probabilityToLose: 0.3333333333},
    {number: 24, multiplier: 20, qualityBonus: 51,  bonusLuck: 500, probabilityToLose: 0.5},
];

export const GameSteps = [
    {number: 0, multiplier: 1, qualityBonus: 0,  bonusLuck: 0, probabilityToLose: 0},
    {number: 1, multiplier: 1.03, qualityBonus: 6875,  bonusLuck: 5, probabilityToLose: 0.96},
    {number: 2, multiplier: 1.06, qualityBonus: 6875,  bonusLuck: 5, probabilityToLose: 0.92},
    {number: 3, multiplier: 1.12, qualityBonus: 6875,  bonusLuck: 5, probabilityToLose: 0.88},
    {number: 4, multiplier: 1.2, qualityBonus: 6875,  bonusLuck: 5, probabilityToLose: 0.84},
    {number: 5, multiplier: 1.25, qualityBonus: 5833,  bonusLuck: 7, probabilityToLose: 0.8},
    {number: 6, multiplier: 1.3, qualityBonus:  5833,  bonusLuck: 7, probabilityToLose: 0.76},
    {number: 7, multiplier: 1.35, qualityBonus: 5833,  bonusLuck: 7, probabilityToLose: 0.72},
    {number: 8, multiplier: 1.45, qualityBonus: 5833,  bonusLuck: 7, probabilityToLose: 0.68},
    {number: 9, multiplier: 1.55, qualityBonus: 5184,  bonusLuck: 10, probabilityToLose: 0.64},
    {number: 10, multiplier: 1.65, qualityBonus: 5184,  bonusLuck: 10, probabilityToLose: 0.6},
    {number: 11, multiplier: 1.75, qualityBonus: 5184,  bonusLuck: 10, probabilityToLose: 0.56},
    {number: 12, multiplier: 1.85, qualityBonus: 5184,  bonusLuck: 10, probabilityToLose: 0.52},
    {number: 13, multiplier: 2, qualityBonus: 4167,  bonusLuck: 20, probabilityToLose: 0.48},
    {number: 14, multiplier: 2.25, qualityBonus: 4167,  bonusLuck: 20, probabilityToLose: 0.44},
    {number: 15, multiplier: 2.5, qualityBonus: 4167,  bonusLuck: 20, probabilityToLose: 0.4},
    {number: 16, multiplier: 2.75, qualityBonus: 3788,  bonusLuck: 30, probabilityToLose: 0.36},
    {number: 17, multiplier: 3, qualityBonus: 3788,  bonusLuck: 30, probabilityToLose: 0.32},
    {number: 18, multiplier: 3.5, qualityBonus: 3472,  bonusLuck: 50, probabilityToLose: 0.28},
    {number: 19, multiplier: 4, qualityBonus: 1667,  bonusLuck: 75, probabilityToLose: 0.24},
    {number: 20, multiplier: 5, qualityBonus: 1042,  bonusLuck: 100, probabilityToLose: 0.2},
    {number: 21, multiplier: 6, qualityBonus: 833,  bonusLuck: 150, probabilityToLose: 0.16},
    {number: 22, multiplier: 8, qualityBonus: 694,  bonusLuck: 200, probabilityToLose: 0.12},
    {number: 23, multiplier: 10, qualityBonus: 595,  bonusLuck: 300, probabilityToLose: 0.08},
    {number: 24, multiplier: 20, qualityBonus: 51,  bonusLuck: 500, probabilityToLose: 0.04},
];

function randomInclusive() {
    // Выбираем большое число, например 2^32 - 1
    const N = Math.pow(2, 32) + 1;
    // Генерируем целое число от 0 до N включительно:
    const randomInt = Math.floor(Math.random() * (N + 1));
    return randomInt / N;
}

function simulateCumulative(iterations) {
    const counts = new Array(GameSteps.length + 1).fill(0);
    const t = GameSteps.reduce((sum, step) => sum + step.probabilityToLose, 0);

    for (let i = 0; i < iterations; i++) {
        const rand = randomInclusive();
        let cumulative = 0;
        let chosen = -1;

        for (let j = 0; j < GameSteps.length; j++) {
            cumulative += GameSteps[j].probabilityToLose;
            if (rand < cumulative / t) {
                chosen = j;
                break;
            }
        }

        if (chosen === -1) chosen = GameSteps.length;
            counts[chosen]++;
        }
    return counts;
}

function simulateRandom(iterations) {
    const counts = new Array(GameSteps.length + 1).fill(0);

    for (let i = 0; i < iterations; i++) {
        let chosen = -1;
        chosen = Math.floor(Math.random() * (GameSteps.length + 1));
        counts[chosen]++;
    }
    return counts;
}

function simulateSequential(iterations) {
    const counts = new Array(GameSteps.length + 1).fill(0);

    for (let i = 0; i < iterations; i++) {
        let chosen = -1;
        chosen = getLine();
        counts[chosen]++;
    }

    return counts;
}

function getLine() {
    const lines =  GameSteps.length - 1;
    let l = GameSteps.length - 1;
    let t = 2;
    let steps = 0;
    for (let i = 0; i < lines; i++) {
        if (Math.random() < t / (t + l)) {
            return steps;
        }
        l = l - 1;
        steps = steps + 1;
    }
    return steps;
}

// Запускаем симуляции
const iterations = 1_000_000;
const countRandom = simulateRandom(iterations);
const countsCumulative = simulateCumulative(iterations);
const countsSequential = simulateSequential(iterations);

console.log("Алгоритм 0 (рандом):");
countRandom.forEach((steps, i) => {
    const freq = (steps / iterations * 100).toFixed(2);
    console.log(`Шаг ${i}:  loses ${freq}%  sym=${steps}`);
})

console.log("Алгоритм 1 (кумулятивный):");
countsCumulative.forEach((steps, i) => {
    const freq = (steps / iterations * 100).toFixed(2);
    console.log(`Шаг ${i}: loses = ${freq}%  sym=${steps}`);
});

console.log("\nАлгоритм 2 (от математика):");
countsSequential.forEach((steps, i) => {
    const freq = (steps / iterations * 100).toFixed(2);
    console.log(`Шаг ${i}: loses = ${freq}%  сумма проигрышей на этом шаге=${steps}`);
});


